@let isLoading = store.isLoading();
@let roleCount = store.roles()[1];
@let roles = store.roles()[0];
<div class="dashboard-main-content">
  <div class="flex flex-col md:flex-row gap-4 md:justify-between md:items-center mb-4">
    <app-ui-badge [label]="roleCount.toString() + ' Rôles'" />
    <button
      class="ui-button ui-button-small ui-button-primary disabled:opacity-40 disabled:cursor-not-allowed"
      [disabled]="isCreating()"
      (click)="onToggleCreation()">
      Nouveau rôle
    </button>
  </div>

  <form
    class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 md:gap-6 my-8"
    [formGroup]="createForm"
    (ngSubmit)="onCreate()"
    [class.hidden]="!isCreating()">
    <div class="flex-1">
      <app-ui-input
        [required]="true"
        [id]="'role-name-create'"
        formControlName="name"
        placeholder="Ex: Administrateur, Modérateur, Éditeur..." />
    </div>
    <div class="flex items-center gap-3">
      <app-ui-button type="button" size="small" variant="secondary" [outlined]="true" (clicked)="onCancelCreation()">
        Annuler
      </app-ui-button>
      <app-ui-button
        type="submit"
        size="small"
        variant="primary"
        [disabled]="createForm.invalid || store.isLoading()"
        [loading]="store.isLoading()">
        Ajouter
      </app-ui-button>
    </div>
  </form>
  <form [formGroup]="searchForm" class="search-input-wrapper">
    <div class="search-input-group">
      <div class="search-input-icon">
        <i-lucide [name]="icons.Search" class="search-input-icon-svg" />
      </div>
      <label for="role-search-input" class="sr-only">Rechercher un rôle</label>
      <input
        type="text"
        id="role-search-input"
        name="q"
        formControlName="q"
        placeholder="Rechercher un rôle..."
        class="search-input"
        autocomplete="off" />
    </div>
  </form>
  <div class="mt-6">
    @if (isLoading && roleCount === 0) {
      <app-ui-table-skeleton [rows]="10" [columns]="3" />
    }
    @if (roleCount > 0) {
      <div class="ui-table-wrapper">
        <table class="ui-table">
          <thead class="ui-table-head">
            <tr class="ui-table-head-row">
              <th class="ui-table-header">Nom</th>
              <th class="ui-table-header">Actions</th>
            </tr>
          </thead>
          <tbody class="ui-table-body">
            @for (role of roles; track role.id) {
              @if (!isEditing(role.id)) {
                <tr class="ui-table-row">
                  <td class="ui-table-cell whitespace-nowrap">
                    <p class="font-semibold text-gray-900">{{ role.name | titlecase }}</p>
                  </td>
                  <td class="ui-table-cell">
                    <div class="flex items-center gap-1">
                      <button (click)="onEdit(role)" class="action-button-default">
                        <i-lucide [name]="icons.Pencil" class="size-4" />
                        Modifier
                      </button>
                      <button (click)="onDelete(role.id)" class="action-button-danger">
                        <i-lucide [name]="icons.Trash" class="size-4" />
                        Supprimer
                      </button>
                    </div>
                  </td>
                </tr>
              }
              <tr class="border-b border-gray-200 bg-gray-50" [class.hidden]="!isEditing(role.id)">
                <td colspan="2" class="ui-table-cell">
                  <form class="flex items-center gap-6" [formGroup]="updateForm" (ngSubmit)="onUpdate()">
                    <div class="flex-1">
                      <app-ui-input
                        [required]="true"
                        [id]="'role-name-update-' + role.id"
                        formControlName="name"
                        placeholder="Ex: Administrateur, Modérateur, Éditeur..." />
                    </div>
                    <div class="flex items-center gap-3">
                      <app-ui-button
                        type="button"
                        size="small"
                        variant="secondary"
                        [outlined]="true"
                        (clicked)="onCancelUpdate()">
                        Annuler
                      </app-ui-button>
                      <app-ui-button
                        type="submit"
                        size="small"
                        variant="primary"
                        [disabled]="updateForm.invalid || store.isLoading()"
                        [loading]="store.isLoading()">
                        Mettre à jour
                      </app-ui-button>
                    </div>
                  </form>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
    <div class="flex flex-col justify-end items-end">
      <app-ui-pagination
        [currentPage]="currentPage()"
        [totalItems]="roleCount"
        [itemsPerPage]="itemsPerPage"
        (pageChange)="onPageChange($event)" />
    </div>
  </div>
  @if (roleCount === 0 && !isLoading) {
    <div class="flex flex-col items-start justify-center mt-10">
      <div class="mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-primary-50 border border-primary-100">
        <i-lucide [name]="icons.Search" class="w-10 h-10 stroke-[1.5] text-primary-500" />
      </div>
      <h3 class="text-2xl font-bold text-gray-900 mb-2">Aucun rôle trouvé</h3>
      <p class="text-gray-500 max-w-lg mb-8 text-base leading-relaxed">
        Nous n'avons trouvé aucun rôle correspondant à vos critères.<br />
      </p>
      <app-ui-button (clicked)="onResetFilters()" variant="secondary" [outlined]="true">
        Réinitialiser les filtres
      </app-ui-button>
    </div>
  }
  <app-ui-confirm-dialog />
</div>
