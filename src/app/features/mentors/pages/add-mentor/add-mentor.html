<section class="pt-32 dashboard-main-content flex flex-col gap-6">
  <div class="relative overflow-hidden rounded-2xl border border-gray-200 bg-gray-100 p-6 md:p-8">
    <div class="relative flex flex-col gap-3">
      <span
        class="inline-flex w-fit items-center rounded-full border border-sky-200 bg-white/80 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-sky-700">
        Gestion des mentors
      </span>
      <h1 class="text-2xl font-bold text-gray-900 md:text-3xl">Ajouter un mentor</h1>
      <p class="max-w-2xl text-sm text-gray-600 md:text-base">
        Renseignez les informations du profil utilisateur et du mentor dans un seul formulaire.
      </p>
    </div>
  </div>

  <form
    class="rounded-2xl border border-gray-200 bg-white p-5 shadow-sm md:p-7"
    [formGroup]="form"
    (ngSubmit)="onSubmit()">
    <div class="mb-6 flex flex-col gap-2 border-b border-gray-100 pb-5">
      <h2 class="text-lg font-semibold text-gray-900">Informations utilisateur</h2>
      <p class="text-sm text-gray-600">Ces informations alimentent le profil propri√©taire du mentor.</p>
    </div>

    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
      <app-ui-input
        [id]="'email'"
        label="Email"
        formControlName="email"
        class="w-full"
        placeholder="exemple@email.com" />
      <app-ui-input
        [id]="'name'"
        label="Nom complet"
        formControlName="name"
        class="w-full"
        placeholder="Nom du mentor" />
      <app-ui-input
        [id]="'phone_number'"
        label="Numero de telephone"
        formControlName="phone_number"
        class="w-full"
        placeholder="+243 XXX XXX XXX" />
      <app-ui-select
        [id]="'gender'"
        label="Genre"
        [options]="genders"
        formControlName="gender"
        class="w-full"
        placeholder="Selectionner un genre" />
      <app-ui-input [id]="'city'" label="Ville" formControlName="city" class="w-full" placeholder="Ex: Kinshasa" />
      <app-ui-input [id]="'country'" label="Pays" formControlName="country" class="w-full" placeholder="Ex: RDC" />
      <app-ui-datepicker [id]="'birth_date'" label="Date de naissance" formControlName="birth_date" class="w-full" />
      <div class="lg:col-span-2">
        <app-ui-textarea
          [id]="'biography'"
          label="Biographie"
          formControlName="biography"
          class="w-full"
          [rows]="4"
          placeholder="Biographie du mentor" />
      </div>
    </div>

    <div class="my-8 border-b border-gray-100"></div>

    <div class="mb-6 flex flex-col gap-2">
      <h2 class="text-lg font-semibold text-gray-900">Informations mentor</h2>
      <p class="text-sm text-gray-600">Ajoutez les expertises, annees d'experience et parcours professionnel.</p>
    </div>

    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
      <app-ui-input
        [id]="'years_experience'"
        label="Annees d'experience"
        formControlName="years_experience"
        class="w-full"
        placeholder="Ex: 5" />
      <app-ui-input
        [id]="'type'"
        label="Type de mentor"
        formControlName="type"
        class="w-full"
        placeholder="Optionnel" />
      <div class="lg:col-span-2">
        <app-ui-multi-select
          [id]="'expertises'"
          label="Expertises"
          [optionLabel]="'name'"
          [optionValue]="'id'"
          [options]="expertisesStore.allExpertises()"
          formControlName="expertises"
          placeholder="Selectionner une ou plusieurs expertises" />
      </div>
      <div class="lg:col-span-2" [formGroup]="newExpertiseForm">
        <div class="grid grid-cols-1 gap-3 md:grid-cols-[1fr_auto] md:items-end">
          <app-ui-input
            [id]="'new_expertise_name'"
            label="Nouvelle expertise"
            formControlName="name"
            class="w-full"
            placeholder="Ex: Data Science" />
          <app-ui-button
            type="button"
            variant="secondary"
            [outlined]="true"
            [loading]="expertisesStore.isLoading()"
            [disabled]="expertisesStore.isLoading() || newExpertiseForm.invalid"
            (clicked)="onCreateExpertise()">
            Ajouter l'expertise
          </app-ui-button>
        </div>
      </div>
    </div>

    <div class="mt-8 flex items-center justify-between">
      <h3 class="text-base font-semibold text-gray-900">Experiences professionnelles</h3>
      <app-ui-button type="button" variant="secondary" [outlined]="true" (clicked)="addExperience()">
        Ajouter une experience
      </app-ui-button>
    </div>

    <div formArrayName="experiences" class="mt-4 space-y-4">
      @for (experienceControl of experiences.controls; track $index) {
        <div [formGroupName]="$index" class="rounded-xl border border-gray-200 p-4">
          <div class="grid grid-cols-1 gap-4 lg:grid-cols-2">
            <app-ui-input
              [id]="'company_name_' + $index"
              label="Entreprise"
              formControlName="company_name"
              class="w-full"
              placeholder="Nom de l'entreprise" />
            <app-ui-input
              [id]="'job_title_' + $index"
              label="Poste"
              formControlName="job_title"
              class="w-full"
              placeholder="Intitule du poste" />
            <app-ui-datepicker
              [id]="'start_date_' + $index"
              label="Date de debut"
              formControlName="start_date"
              class="w-full" />
            <app-ui-datepicker
              [id]="'end_date_' + $index"
              label="Date de fin"
              formControlName="end_date"
              class="w-full" />
            <div class="lg:col-span-2">
              <app-ui-checkbox [id]="'is_current_' + $index" [label]="'Poste actuel'" formControlName="is_current" />
            </div>
          </div>
          <div class="mt-4 flex justify-end">
            <app-ui-button
              type="button"
              variant="danger"
              [outlined]="true"
              [disabled]="experiences.length === 1"
              (clicked)="removeExperience($index)">
              Supprimer
            </app-ui-button>
          </div>
        </div>
      }
    </div>

    <div class="mt-8 flex justify-end border-t border-gray-200 pt-6">
      <app-ui-button
        [size]="'small'"
        [loading]="store.isSaving()"
        [disabled]="store.isSaving() || form.invalid"
        type="submit"
        variant="primary">
        Creer le mentor
      </app-ui-button>
    </div>
  </form>
</section>
