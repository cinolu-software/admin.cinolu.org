@let venture = store.venture(); @let isLoading = store.isLoading();
<div class="dashboard-main-content">
  <div class="mb-6">
    <h5 class="text-2xl font-bold text-gray-900">Détails de la startup</h5>
  </div>
  @if (isLoading) {
    <app-venture-skeleton />
  } @else if (venture) {
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm mb-6 overflow-hidden">
      @if (venture.cover) {
        <div class="h-48 w-full overflow-hidden">
          <img [src]="venture | apiIMG: 'ventureCover'" [alt]="venture.name" class="w-full h-full object-cover" />
        </div>
      }
      <div class="p-6">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-6">
          @if (venture.logo) {
            <img
              [src]="venture | apiIMG: 'venture'"
              [alt]="venture.name"
              class="w-24 h-24 rounded-xl object-cover border-4 border-white shadow-lg" />
          } @else {
            <div
              class="w-24 h-24 rounded-xl bg-primary-100 flex items-center justify-center text-primary-600 font-bold text-2xl border-4 border-white shadow-lg">
              {{ venture.name.charAt(0).toUpperCase() }}
            </div>
          }
          <div class="flex-1">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
              <div>
                <h3 class="text-3xl font-bold text-gray-900 mb-2">{{ venture.name }}</h3>
                @if (venture.description) {
                  <p class="text-gray-600 text-base leading-relaxed max-w-3xl">{{ venture.description }}</p>
                }
              </div>
              <app-ui-badge
                [label]="venture.is_published ? 'Publié' : 'Non publié'"
                [variant]="venture.is_published ? 'success' : 'warning'"
                [size]="'medium'" />
            </div>
            <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600">
              @if (venture.sector) {
                <div class="flex items-center gap-2 px-3 py-1.5 bg-primary-50 rounded-lg border border-primary-200">
                  <i-lucide [name]="icons.Building2" class="size-4 text-primary-600" />
                  <span class="font-medium">{{ venture.sector }}</span>
                </div>
              }
              @if (venture.stage) {
                <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-50 rounded-lg border border-gray-200">
                  <span class="font-medium">{{ venture.stage }}</span>
                </div>
              }
              @if (venture.founded_at) {
                <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-50 rounded-lg border border-gray-200">
                  <i-lucide [name]="icons.Calendar" class="size-4 text-gray-600" />
                  <span class="font-medium">Fondé en {{ formatDate(venture.founded_at) }}</span>
                </div>
              }
              @if (venture.location) {
                <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-50 rounded-lg border border-gray-200">
                  <i-lucide [name]="icons.MapPin" class="size-4 text-gray-600" />
                  <span class="font-medium">{{ venture.location }}</span>
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
      <div class="lg:col-span-1">
        <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
              <i-lucide [name]="icons.Building2" class="w-5 h-5 text-primary-600" />
            </div>
            <h4 class="text-lg font-bold text-gray-900">Propriétaire</h4>
          </div>
          <div class="flex items-center gap-3 mb-4">
            <app-ui-avatar [shape]="'circle'" [image]="venture.owner | apiIMG: 'user'" [label]="venture.owner.name" />
            <div class="flex-1">
              <p class="font-semibold text-gray-900">{{ venture.owner.name }}</p>
              <p class="text-sm text-gray-500">{{ venture.owner.email }}</p>
            </div>
          </div>
        </div>
      </div>
      <div class="lg:col-span-2">
        <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
              <i-lucide [name]="icons.Mail" class="w-5 h-5 text-primary-600" />
            </div>
            <h4 class="text-lg font-bold text-gray-900">Informations de contact</h4>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            @if (venture.email) {
              <a
                [href]="'mailto:' + venture.email"
                class="flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:border-primary-300 hover:bg-primary-50 transition-all duration-200 group">
                <div
                  class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                  <i-lucide [name]="icons.Mail" class="w-5 h-5 text-primary-600" />
                </div>
                <div class="flex-1">
                  <p class="text-xs text-gray-500 mb-0.5">Email</p>
                  <p class="text-sm font-medium text-gray-900">{{ venture.email }}</p>
                </div>
              </a>
            }
            @if (venture.phone_number) {
              <a
                [href]="'tel:' + venture.phone_number"
                class="flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:border-primary-300 hover:bg-primary-50 transition-all duration-200 group">
                <div
                  class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                  <i-lucide [name]="icons.Phone" class="w-5 h-5 text-primary-600" />
                </div>
                <div class="flex-1">
                  <p class="text-xs text-gray-500 mb-0.5">Téléphone</p>
                  <p class="text-sm font-medium text-gray-900">{{ venture.phone_number }}</p>
                </div>
              </a>
            }
            @if (venture.website) {
              <a
                [href]="venture.website"
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:border-primary-300 hover:bg-primary-50 transition-all duration-200 group">
                <div
                  class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                  <i-lucide [name]="icons.Globe" class="w-5 h-5 text-primary-600" />
                </div>
                <div class="flex-1">
                  <p class="text-xs text-gray-500 mb-0.5">Site web</p>
                  <p class="text-sm font-medium text-gray-900 truncate">{{ venture.website }}</p>
                </div>
                <i-lucide [name]="icons.ExternalLink" class="w-4 h-4 text-gray-400 group-hover:text-primary-600" />
              </a>
            }
            @if (venture.linkedin_url) {
              <a
                [href]="venture.linkedin_url"
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:border-primary-300 hover:bg-primary-50 transition-all duration-200 group">
                <div
                  class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                  <i-lucide [name]="icons.ExternalLink" class="w-5 h-5 text-primary-600" />
                </div>
                <div class="flex-1">
                  <p class="text-xs text-gray-500 mb-0.5">LinkedIn</p>
                  <p class="text-sm font-medium text-gray-900 truncate">Voir le profil</p>
                </div>
                <i-lucide [name]="icons.ExternalLink" class="w-4 h-4 text-gray-400 group-hover:text-primary-600" />
              </a>
            }
          </div>
        </div>
      </div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      @if (venture.problem_solved) {
        <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
          <h4 class="text-lg font-bold text-gray-900 mb-4">Problème résolu</h4>
          <p class="text-gray-600 leading-relaxed">{{ venture.problem_solved }}</p>
        </div>
      }
      @if (venture.target_market) {
        <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
          <h4 class="text-lg font-bold text-gray-900 mb-4">Marché cible</h4>
          <p class="text-gray-600 leading-relaxed">{{ venture.target_market }}</p>
        </div>
      }
    </div>
    @if (venture.gallery && venture.gallery.length > 0) {
      <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6 mb-6">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
            <i-lucide [name]="icons.ImageIcon" class="w-5 h-5 text-primary-600" />
          </div>
          <h4 class="text-lg font-bold text-gray-900">Galerie ({{ venture.gallery.length }})</h4>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          @for (image of venture.gallery; track image.id) {
            <div
              class="relative group overflow-hidden rounded-lg border border-gray-200 hover:border-primary-300 transition-all duration-200">
              <div class="h-28 md:h-36 w-full overflow-hidden relative">
                <img
                  [ngSrc]="image | apiIMG: 'gallery'"
                  [alt]="venture.name"
                  class="object-cover group-hover:scale-105 transition-transform duration-200"
                  fill />
              </div>
            </div>
          }
        </div>
      </div>
    }
    @if (venture.products && venture.products.length > 0) {
      <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6 mb-6">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
            <i-lucide [name]="icons.Package" class="w-5 h-5 text-primary-600" />
          </div>
          <h4 class="text-lg font-bold text-gray-900">Produits ({{ venture.products.length }})</h4>
        </div>
        <div class="space-y-6">
          @for (product of venture.products; track product.id) {
            <div
              class="bg-gray-50 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 hover:border-primary-200 overflow-hidden">
              <div class="p-6">
                <div class="flex flex-col md:flex-row gap-6">
                  <!-- Product Gallery -->
                  @if (product.gallery && product.gallery.length > 0) {
                    <div class="shrink-0 w-full md:w-48 lg:w-64">
                      <div class="rounded-lg overflow-hidden border border-gray-200 bg-white">
                        <div class="h-48 w-full relative overflow-hidden">
                          <img
                            [ngSrc]="product.gallery[0] | apiIMG: 'gallery'"
                            [alt]="product.name"
                            class="w-full h-full object-cover hover:scale-105 transition-transform duration-200"
                            fill />
                        </div>
                        @if (product.gallery.length > 1) {
                          <div class="p-3 bg-white border-t border-gray-200">
                            <p class="text-xs text-gray-500 text-center">+{{ product.gallery.length - 1 }} image(s)</p>
                          </div>
                        }
                      </div>
                    </div>
                  } @else {
                    <div class="shrink-0 w-full md:w-48 lg:w-64">
                      <div
                        class="h-48 rounded-lg bg-linear-to-br from-gray-100 to-gray-200 flex items-center justify-center border border-gray-300">
                        <i-lucide [name]="icons.ImageIcon" class="w-8 h-8 text-gray-400" />
                      </div>
                    </div>
                  }

                  <!-- Product Info -->
                  <div class="flex-1">
                    <h5 class="text-xl font-bold text-gray-900 mb-3">{{ product.name }}</h5>
                    @if (product.description) {
                      <p class="text-gray-600 mb-4 leading-relaxed">{{ product.description }}</p>
                    }
                    <div class="flex flex-wrap items-center justify-between gap-4">
                      @if (product.price) {
                        <div>
                          <p class="text-sm text-gray-500 mb-1">Prix</p>
                          <span class="text-2xl font-bold text-primary-600">{{
                            product.price | currency: 'USD' : 'symbol' : '1.0-0'
                          }}</span>
                        </div>
                      } @else {
                        <div>
                          <p class="text-sm text-gray-500">Prix</p>
                          <span class="text-sm font-medium text-gray-400">Non disponible</span>
                        </div>
                      }
                      @if (product.gallery && product.gallery.length > 1) {
                        <button
                          (click)="viewProductGallery(product)"
                          class="px-4 py-2 rounded-lg border border-primary-300 text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">
                          Voir galerie ({{ product.gallery.length }})
                        </button>
                      }
                    </div>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Actions Footer -->
    <div class="mt-6 flex items-center justify-between bg-white rounded-xl border border-gray-200 shadow-sm p-4">
      <div class="text-sm text-gray-600">
        <span class="font-medium">Créé le:</span> {{ venture.created_at | date: 'longDate' }}
      </div>
      <button
        (click)="onTogglePublish()"
        class="ui-button ui-button-small"
        [class.ui-button-primary]="!venture.is_published"
        [class.ui-button-secondary]="venture.is_published">
        <i-lucide [name]="venture.is_published ? icons.ToggleRight : icons.ToggleLeft" class="size-4" />
        {{ venture.is_published ? 'Dépublier' : 'Publier' }}
      </button>
    </div>

    <!-- Product Gallery Modal -->
    @if (selectedProductGallery(); as gallery) {
      <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full overflow-hidden">
          <!-- Header -->
          <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50">
            <div>
              <h3 class="text-lg font-bold text-gray-900">{{ gallery.product.name }} - Galerie</h3>
              <p class="text-sm text-gray-500 mt-1">
                Image {{ gallery.index + 1 }} sur {{ gallery.product.gallery.length }}
              </p>
            </div>
            <button (click)="closeProductGallery()" class="p-2 hover:bg-gray-200 rounded-lg transition-colors">
              <i-lucide [name]="icons.X" class="w-6 h-6 text-gray-600" />
            </button>
          </div>

          <!-- Gallery Content -->
          <div class="relative bg-black">
            <div class="h-96 md:h-128 w-full flex items-center justify-center overflow-hidden relative">
              @let currentImage = gallery.product.gallery[gallery.index];
              @if (currentImage) {
                <img
                  [ngSrc]="currentImage | apiIMG: 'gallery'"
                  [alt]="gallery.product.name"
                  class="w-full h-full object-contain"
                  fill />
              }
            </div>

            <!-- Navigation Buttons -->
            @if (gallery.product.gallery.length > 1) {
              <button
                (click)="prevGalleryImage()"
                class="absolute left-4 top-1/2 -translate-y-1/2 p-2 rounded-full bg-white bg-opacity-80 hover:bg-opacity-100 transition-all">
                <i-lucide [name]="icons.ChevronLeft" class="w-6 h-6 text-gray-900" />
              </button>
              <button
                (click)="nextGalleryImage()"
                class="absolute right-4 top-1/2 -translate-y-1/2 p-2 rounded-full bg-white bg-opacity-80 hover:bg-opacity-100 transition-all">
                <i-lucide [name]="icons.ChevronRight" class="w-6 h-6 text-gray-900" />
              </button>
            }
          </div>

          <!-- Thumbnails -->
          @if (gallery.product.gallery.length > 1) {
            <div class="p-4 bg-gray-50 border-t border-gray-200">
              <div class="flex gap-2 overflow-x-auto pb-2">
                @for (image of gallery.product.gallery; track image.id; let idx = $index) {
                  <button
                    (click)="selectedProductGallery.set(updateGalleryIndex(idx))"
                    [class.ring-2]="idx === gallery.index"
                    class="shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 border-transparent hover:border-primary-300 transition-all"
                    [class.ring-primary-500]="idx === gallery.index">
                    <img
                      [ngSrc]="image | apiIMG: 'gallery'"
                      [alt]="`Thumbnail ${idx + 1}`"
                      class="w-full h-full object-cover"
                      fill />
                  </button>
                }
              </div>
            </div>
          }
        </div>
      </div>
    }
  }
  <app-ui-confirm-dialog />
</div>
